(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{146:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),p=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=p(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},u=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),b=p(n),u=a,m=b["".concat(o,".").concat(u)]||b[u]||d[u]||r;return n?i.a.createElement(m,l(l({ref:t},c),{},{components:n})):i.a.createElement(m,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<r;c++)o[c]=n[c];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},148:function(e,t,n){"use strict";var a=n(0),i=n(21);t.a=function(){const e=Object(a.useContext)(i.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},150:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o}));var a=n(148),i=n(154);function r(){const{siteConfig:{baseUrl:e="/",url:t}={}}=Object(a.a)();return{withBaseUrl:(n,a)=>function(e,t,n,a){let{forcePrependBaseUrl:r=!1,absolute:o=!1}=void 0===a?{}:a;if(!n)return n;if(n.startsWith("#"))return n;if(Object(i.b)(n))return n;if(r)return t+n;const l=n.startsWith(t)?n:t+n.replace(/^\//,"");return o?e+l:l}(t,e,n,a)}}function o(e,t){void 0===t&&(t={});const{withBaseUrl:n}=r();return n(e,t)}},154:function(e,t,n){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!a(e)}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}))},172:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/a440-206ada68784412d709d57893da8f389e.wav"},193:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/sound-sinewave-852e6c6a751de54a079f42afd2f270a1.png"},194:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/sound-sinewave-cycles-2c4fc7ee671d8fba7ee1cd002fe2528e.png"},195:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/sound-sinewave-samples-836e8f3c7a1ca1c2e71bd0fd27d6a69c.png"},196:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/sound-noclip-8a2e991ca0e77b1449e3d2bf8beba436.png"},197:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/sound-clip-f35397ef050673b7eb36adc61136cec1.png"},198:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/sound-square-7cdd1f0f52c1b76a5c3d5750fc41784c.png"},199:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/sound-saw-7fe832f1b48f8ea0e78fc130aca71dc4.png"},200:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/adsr_envelope-b9b0d82ee6feb5035811a25284723488.png"},201:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/a440_sq-e1f9a34f3f8a1a606cdc753bc0ddcab7.wav"},202:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/a440_saw-b68ae9dcb547aabfcbbd8b21d768ee1f.wav"},203:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/example-f8705e42c8bd6b0ff6604db5900d4aa9.wav"},204:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/tocc_dm-b24744eb676478fd0a106d6d37b39059.mp3"},205:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/bwv645-7c47abc58f46e925e50d8f302dbcf3b8.mp3"},89:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(2),i=(n(0),n(146)),r=n(150);const o={id:"midterm",title:"Midterm Project"},l={unversionedId:"assignments/midterm",id:"assignments/midterm",isDocsHomePage:!1,title:"Midterm Project",description:"* You are expected to work as a team of two.",source:"@site/docs\\assignments\\midterm.md",slug:"/assignments/midterm",permalink:"/cs220-f22/docs/assignments/midterm",version:"current"},s=[{value:"Getting started",id:"getting-started",children:[{value:"Set up your midterm project git repository",id:"set-up-your-midterm-project-git-repository",children:[]},{value:"Get the starter codes from the public repository",id:"get-the-starter-codes-from-the-public-repository",children:[]},{value:"Programming tasks overview",id:"programming-tasks-overview",children:[]}]},{value:"What sound is",id:"what-sound-is",children:[{value:"Complex audio waveforms",id:"complex-audio-waveforms",children:[]},{value:"Digital sound",id:"digital-sound",children:[]},{value:"Mixing digital audio signals, clipping",id:"mixing-digital-audio-signals-clipping",children:[]},{value:"Stereo sound, WAVE files",id:"stereo-sound-wave-files",children:[]}]},{value:"I/O functions",id:"io-functions",children:[{value:"<code>fatal_error</code> function",id:"fatal_error-function",children:[]},{value:"Binary I/O functions",id:"binary-io-functions",children:[]}]},{value:"Wave functions",id:"wave-functions",children:[{value:"<code>wave.h</code>",id:"waveh",children:[]},{value:"<code>read_wave_header</code>, <code>write_wave_header</code>",id:"read_wave_header-write_wave_header",children:[]},{value:"Rendering tones, wave functions",id:"rendering-tones-wave-functions",children:[]},{value:"Hints on how to render waveforms",id:"hints-on-how-to-render-waveforms",children:[]},{value:"Mixing is additive!",id:"mixing-is-additive",children:[]}]},{value:"The <code>render_tone</code> program",id:"the-render_tone-program",children:[{value:"Invocation of <code>render_tone</code>",id:"invocation-of-render_tone",children:[]},{value:"<code>render_tone</code> examples",id:"render_tone-examples",children:[]},{value:"<code>render_tone</code> suggested approach",id:"render_tone-suggested-approach",children:[]}]},{value:"The <code>render_song</code> program",id:"the-render_song-program",children:[{value:"Invocation, input data format",id:"invocation-input-data-format",children:[]},{value:"<code>render_song</code> example",id:"render_song-example",children:[]},{value:"Important <code>struct</code> requirement",id:"important-struct-requirement",children:[]},{value:"<code>render_song</code> suggested approach",id:"render_song-suggested-approach",children:[]}]},{value:"The <code>render_echo</code> program",id:"the-render_echo-program",children:[{value:"Invocation",id:"invocation",children:[]},{value:"Generating an echo",id:"generating-an-echo",children:[]},{value:"Examples",id:"examples",children:[]},{value:"<code>render_echo</code> suggested approach",id:"render_echo-suggested-approach",children:[]}]},{value:"Testing",id:"testing",children:[{value:"Getting files to your local computer",id:"getting-files-to-your-local-computer",children:[]},{value:"Example files",id:"example-files",children:[]},{value:"Song files",id:"song-files",children:[]},{value:"Sound files",id:"sound-files",children:[]}]},{value:"Tips",id:"tips",children:[{value:"Passing part of an array to a function",id:"passing-part-of-an-array-to-a-function",children:[]},{value:"Math functions",id:"math-functions",children:[]},{value:"Converting command line arguments to numeric values",id:"converting-command-line-arguments-to-numeric-values",children:[]},{value:"Use binary mode for input and output",id:"use-binary-mode-for-input-and-output",children:[]}]},{value:"Packaging and submission requirements",id:"packaging-and-submission-requirements",children:[]}],c={rightToc:s};function p(e){let{components:t,...o}=e;return Object(i.b)("wrapper",Object(a.a)({},c,o,{components:t,mdxType:"MDXLayout"}),Object(i.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("ul",{parentName:"div"},Object(i.b)("li",{parentName:"ul"},"You are expected to work as a team of two."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Due: Thursday ",Object(i.b)("strong",{parentName:"strong"},"March 25th")," at 11pm EDT (Baltimore time).")),Object(i.b)("li",{parentName:"ul"},"No late days are allowed!")))),Object(i.b)("h1",{id:"introduction"},"Introduction"),Object(i.b)("p",null,"In this project you will implement helper functions and programs to\ngenerate and transform digital audio."),Object(i.b)("p",null,"This is a paired project, so you will work with one classmate.  You should\npractice pair programming where you work synchronously with your partner, in\ndriver/navigator roles, to design and implement the program.  We will spend some time in\nclass working on the project, so your partner needs to be in your section. ","[Students who cannot attend class synchronously should find a partner in the same time zone.]"),Object(i.b)("p",null,"You will use git for version control. You should have registered your team ",Object(i.b)("a",{parentName:"p",href:"https://piazza.com/class/kjipwszll9atf?cid=436"},"here")," by ",Object(i.b)("em",{parentName:"p"},"Thursday March 4th at noon"),". Otherwise, we will pair you up with a classmate. A private repo repo named something like ",Object(i.b)("inlineCode",{parentName:"p"},"2021-spring-midterm-<JHED1>-<JHED2>")," will be created for your team. You should use this repo for your midterm project development."),Object(i.b)("p",null,"The project is larger and more complex than the previous homework\nassignments. You\u2019ll want to start early and make steady, incremental\nprogress towards completing the project requirements."),Object(i.b)("h2",{id:"getting-started"},"Getting started"),Object(i.b)("h3",{id:"set-up-your-midterm-project-git-repository"},"Set up your midterm project git repository"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"If you have registered your team on time, you will see the private repo (",Object(i.b)("inlineCode",{parentName:"p"},"2021-spring-midterm-<JHED1>-<JHED2>"),") under your repositories on GitHub.  ")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Otherwise, you should receive a private post from us about your assigned partner on Piazza. You should reply to the post to exchange your contact information with your teammate and let us know all members are connected. We will assign you the project repo. If you have not received the post, reach out to us as soon as possible."))),Object(i.b)("p",null,"Once you have access to ",Object(i.b)("inlineCode",{parentName:"p"},"2021-spring-midterm-<JHED1>-<JHED2>"),", you should clone the repo to your ugrad unix account (and optionally local machine) the same way you cloned your personal repo in ",Object(i.b)("a",{parentName:"p",href:"/docs/exercises/ex1-3#part-2"},"Ex1-3 Part 2"),"."),Object(i.b)("div",{className:"admonition admonition-info alert alert--info"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"If you have opted to use ",Object(i.b)("a",{parentName:"p",href:"/docs/resources/github-ssh"},"SSH authentication"),", remember to clone it with the ",Object(i.b)("inlineCode",{parentName:"p"},"git@")," link. Otherwise, you should use the ",Object(i.b)("inlineCode",{parentName:"p"},"https://")," one."))),Object(i.b)("h3",{id:"get-the-starter-codes-from-the-public-repository"},"Get the starter codes from the public repository"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Use ",Object(i.b)("inlineCode",{parentName:"p"},"cd")," to move into the public repo folder on your unix account (e.g. ",Object(i.b)("inlineCode",{parentName:"p"},"~/cs220-sp21-public"),"), type ",Object(i.b)("inlineCode",{parentName:"p"},"git status")," and confirm you have not modified any files or accidentally committed to the public repo. Ask for help if you need to undo those accidental changes.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Type ",Object(i.b)("inlineCode",{parentName:"p"},"git pull")," to synchronize your local repo with the remote repo.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"You should see a new folder ",Object(i.b)("inlineCode",{parentName:"p"},"midterm"),", which contains the starter code. There will be four C source files: ",Object(i.b)("inlineCode",{parentName:"p"},"io.h"),", ",Object(i.b)("inlineCode",{parentName:"p"},"io.c"),", ",Object(i.b)("inlineCode",{parentName:"p"},"wave.h"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"wave.c"),".  There will also be several text files (ending in the ",Object(i.b)("inlineCode",{parentName:"p"},".txt")," file extension) as well as several audio files (ending in ",Object(i.b)("inlineCode",{parentName:"p"},".wav")," and ",Object(i.b)("inlineCode",{parentName:"p"},".mp3")," file extensions.)")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Copy the source files and ",Object(i.b)("inlineCode",{parentName:"p"},".txt")," files in ",Object(i.b)("inlineCode",{parentName:"p"},"midterm")," to your midterm project repo. Assuming both the public repo and your midterm repo are under your home directory, and you have not changed the folder names, then you can run ",Object(i.b)("inlineCode",{parentName:"p"},"cp ~/cs220-sp21-public/midterm/*.{c,h,txt} ~/2021-spring-midterm-<JHED1>-<JHED2>/")," to copy the starter codes to your local midterm repo.  (You may eventually want to copy the audio files, but you don't need to do that right away.)")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Use ",Object(i.b)("inlineCode",{parentName:"p"},"cd")," to move into your midterm repo (e.g. ",Object(i.b)("inlineCode",{parentName:"p"},"~/2021-spring-midterm-<JHED1>-<JHED2>"),"), type ",Object(i.b)("inlineCode",{parentName:"p"},"git status")," and confirm you see all the starter files.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Do your first commit to add the starter codes to the repo and push them to the remote repo. You can run ",Object(i.b)("inlineCode",{parentName:"p"},"git add ."),", ",Object(i.b)("inlineCode",{parentName:"p"},'git commit -m "Initialized with the starter codes"'),", and ",Object(i.b)("inlineCode",{parentName:"p"},"git push"),"."))),Object(i.b)("p",null,"Your midterm repo is now ready for development!"),Object(i.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"Only one of the team members needs to set up the repo when it is the first use. Once it has been set up, the partner can get the starter codes directly by cloning the remote repo or synchronizing their local repos (",Object(i.b)("inlineCode",{parentName:"p"},"pull"),"). "),Object(i.b)("p",{parentName:"div"},"You now work in a team. You may encounter ",Object(i.b)("strong",{parentName:"p"},"conflicts")," more often when you push your code from local to remote. This happens when your teammates have changed the same files and same segments as you have done. If it happens, you will need to resolve the conflicts, compile and test your codes before committing the conflict-resolved version. Typically you will see something like below in the file that has a conflict:"),Object(i.b)("pre",{parentName:"div"},Object(i.b)("code",{parentName:"pre"},"<<<<<<< HEAD\nThis is how the file in the current remote (github) repo looks\n\n=======\nThis is how the file in your local repo looks\n\n>>>>>>> <a commit id>\n")),Object(i.b)("p",{parentName:"div"},"To resolve the conflict, you need to decide which version to use or how they should be merged. To minimize the conflicts, you should"),Object(i.b)("ul",{parentName:"div"},Object(i.b)("li",{parentName:"ul"},"Communicate with your teammates to avoid editing a file at the same time,"),Object(i.b)("li",{parentName:"ul"},"Always sync with the remote before you start working, and "),Object(i.b)("li",{parentName:"ul"},"Commit and push often")))),Object(i.b)("h3",{id:"programming-tasks-overview"},"Programming tasks overview"),Object(i.b)("p",null,"There are 6 main parts to this project, each thoroughly described below. Here is a high level overview of the implementation requirements that you can use as a checklist as your team works through the project parts. "),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("em",{parentName:"li"},Object(i.b)("a",{parentName:"em",href:"#io-functions"},"I/O functions:"))," We have provided complete header file ",Object(i.b)("inlineCode",{parentName:"li"},"io.h")," and mostly empty implementation file ",Object(i.b)("inlineCode",{parentName:"li"},"io.c"),". Add implementations for the functions that appear in the header file to file ",Object(i.b)("inlineCode",{parentName:"li"},"io.c")," according to the descriptions below."),Object(i.b)("li",{parentName:"ol"},Object(i.b)("em",{parentName:"li"},Object(i.b)("a",{parentName:"em",href:"#wave-functions"},"Wave functions:"))," We have provided complete header file ",Object(i.b)("inlineCode",{parentName:"li"},"wave.h")," and partial implementation file ",Object(i.b)("inlineCode",{parentName:"li"},"wave.c"),". The implementation of two functions, ",Object(i.b)("inlineCode",{parentName:"li"},"write_wave_header")," and ",Object(i.b)("inlineCode",{parentName:"li"},"read_wave_header")," are included in ",Object(i.b)("inlineCode",{parentName:"li"},"wave.c"),". Your task for this part is to add implementations of the other functions to ",Object(i.b)("inlineCode",{parentName:"li"},"wave.c"),", using the functions you wrote for part 1.",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"compute_pan")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"generate_sine_wave")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"generate_square_wave")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"generate_saw_wave")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"apply_gain")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"apply_adsr_envelope")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"mix_in")))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("em",{parentName:"li"},Object(i.b)("a",{parentName:"em",href:"#the-render_tone-program"},"Tone:"))," Write a program called ",Object(i.b)("inlineCode",{parentName:"li"},"render_tone.c")," that uses the wave functions to create a continuous tone as specified by the program's command-line arguments."),Object(i.b)("li",{parentName:"ol"},Object(i.b)("em",{parentName:"li"},Object(i.b)("a",{parentName:"em",href:"#the-render_song-program"},"Song:"))," Write a program called ",Object(i.b)("inlineCode",{parentName:"li"},"render_song.c")," that uses the wave functions to convert a plain text song input file into a wave sound file. Filenames are supplied as command-line arguments."),Object(i.b)("li",{parentName:"ol"},Object(i.b)("em",{parentName:"li"},Object(i.b)("a",{parentName:"em",href:"#the-render_echo-program"},"Echo:"))," Write a program called ",Object(i.b)("inlineCode",{parentName:"li"},"render_echo.c")," that uses the wave functions to convert a wave sound file into a new one that echos the original as specified by the command-line arguments."),Object(i.b)("li",{parentName:"ol"},Object(i.b)("em",{parentName:"li"},Object(i.b)("a",{parentName:"em",href:"#packaging-and-submission-requirements"},"Makefile:"))," Create a makefile with the specified targets for the three render programs above.")),Object(i.b)("h1",{id:"sound"},"Sound"),Object(i.b)("p",null,"This section has some background about sound and how it can be represented digitally."),Object(i.b)("h2",{id:"what-sound-is"},"What sound is"),Object(i.b)("p",null,"Sound is changes in air pressure over time.  When physical objects\nvibrate, they cause oscillations in air pressure that propagate outwards\nin a wave.  A sensor such as a microphone or your ear can detect these\nchanges in pressure over time."),Object(i.b)("p",null,"The most basic type of oscillation is a sine wave, where the changes in\npressure over time are modeled by the equation"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"p")," = ",Object(i.b)("em",{parentName:"p"},"a")," \xd7 sin(",Object(i.b)("em",{parentName:"p"},"tf")," \xd7 2\u03c0)"),Object(i.b)("p",null,"where ",Object(i.b)("em",{parentName:"p"},"p")," is pressure, ",Object(i.b)("em",{parentName:"p"},"t")," is time, ",Object(i.b)("em",{parentName:"p"},"f")," is frequency, and ",Object(i.b)("em",{parentName:"p"},"a")," is\namplitude.  Because the sine function yields both positive and negative\nvalues, the resulting pressure values (",Object(i.b)("em",{parentName:"p"},"p"),") can be both positive and\nnegative.  The pressure values represent the instantaneous air pressure\nrelative to the overall average air pressure."),Object(i.b)("p",null,"Plotted with time on the x-axis and pressure on the y-axis, a sine wave\nlooks like this:"),Object(i.b)("p",null,Object(i.b)("img",{alt:"Sine wave",src:n(193).default})),Object(i.b)("p",null,"A ",Object(i.b)("em",{parentName:"p"},"cycle")," consists of one full oscillation with both positive and negative peaks:"),Object(i.b)("p",null,Object(i.b)("img",{alt:"Sine wave cycle",src:n(194).default})),Object(i.b)("p",null,"When the frequency increases, the cycles become shorter, so there are more\ncycles per unit of time.  The standard measurement of frequency, the Hertz\n(abbreviated Hz), is defined as one cycle per second.  Sound waves have\nfrequencies that range from the low tens of Hz to tens of thousands of Hz.\nWe perceive sounds with higher frequencies as being higher-pitched."),Object(i.b)("p",null,"Here is what one second of a 440 Hz sine wave sounds like:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/a440.wav")})),Object(i.b)("div",null),Object(i.b)("h3",{id:"complex-audio-waveforms"},"Complex audio waveforms"),Object(i.b)("p",null,"Obviously real sounds are much more complex than just plain sine waves.\nIn general, any sound can be represented by the ",Object(i.b)("em",{parentName:"p"},"sum")," of sine waves of\nvarying frequencies and amplitudes.  Here is one second of a 440 Hz sine\nwave mixed with a 587.33 Hz sine wave:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/a440_third.wav")})),Object(i.b)("div",null),Object(i.b)("p",null,"At a physical level, the air pressure changes as the ",Object(i.b)("em",{parentName:"p"},"sum")," of the pressure\nchanges induced by all of the sine waves being generated.  Humans can\neffectively hear multiple tones at the same time, deconstructing the\nadded sine waves into the constituent frequencies.  The example you just\nheard (440 Hz and 587.33 Hz) is two tones separated by a ",Object(i.b)("em",{parentName:"p"},"major third"),",\nan important frequency interval in western music."),Object(i.b)("h3",{id:"digital-sound"},"Digital sound"),Object(i.b)("p",null,"There are a variety of ways to represent sound using a computer.\nThe most straightforward way is using linear ",Object(i.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Pulse-code_modulation"},"pulse code\nmodulation"),",\nwhere sound is represented as a sequence of ",Object(i.b)("em",{parentName:"p"},"samples"),", each sample\nrepresenting air pressure at a moment in time.  The ",Object(i.b)("em",{parentName:"p"},"sampling frequency"),"\ndetermines how many (evenly spaced) samples there are per unit of time.\nCD quality audio, a common PCM format, uses signed 16 bit samples\n(ranging from -32,768 to 32,767) and a sampling frequency of 44.1 KHz\n(44,100 samples per second).  In C, the ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t")," data type (defined in\nthe ",Object(i.b)("inlineCode",{parentName:"p"},"<stdint.h>")," header file) matches the range of sample data values\nfor CD quality audio.  So, an array of ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t")," elements can represent\nCD quality audio: each 44,100 elements represent one second of monaural audio\nor one half second of stereo audio."),Object(i.b)("p",null,"To make this idea explicit, let's say that the sound we want to represent\nis a sine wave with an amplitude of 0.1 and a frequency of 440 Hz.\nWe'll consider amplitude as being relative to the loudest possible sound,\ndefined as 1.0, so a signal with an amplitude of 0.1 has positive and\nnegative peaks that are 10% as large as the loudest possible signal.\nWith a sampling frequency of 44.1 KHz, each cycle of our 440 Hz audio\nsignal will be represented by about 100 samples (really 100.22727...).  The values of the\nindividual samples will vary between (approximately) -3,276 and 3,276.\nLet's say the audio data is in an array of ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t")," elements called\n",Object(i.b)("inlineCode",{parentName:"p"},"sound"),".  Here is a diagram showing several points on the first cycle\nof the signal, their values, and which array elements they would be\nstored in:"),Object(i.b)("p",null,Object(i.b)("img",{alt:"Sine wave with samples",src:n(195).default})),Object(i.b)("p",null,"As long as the number of bits per sample is reasonably large, and the\nsampling frequency is reasonably high, PCM can represent audio with a\nhigh degree of fidelity to the original sound."),Object(i.b)("h3",{id:"mixing-digital-audio-signals-clipping"},"Mixing digital audio signals, clipping"),Object(i.b)("p",null,"Because sound waves interact additively, you can combine two digital\naudio signals by simply ",Object(i.b)("em",{parentName:"p"},"adding")," their respective sample values."),Object(i.b)("p",null,"A potential problem that can arise when adding sample values is that\nthe sum might exceed the maximum positive or negative sample values: for\nexample, 32,767 and -32,768 for 16 bit signed samples.  If this happens,\nwe can't really fully represent the resulting combined signal.  ",Object(i.b)("em",{parentName:"p"},"Clipping"),"\nis a phenomenon that results from such overflows, in particular, when we\nuse ",Object(i.b)("em",{parentName:"p"},"saturating")," addition such that sums greater than the maximum possible\nvalue or less than the minimum possible value (e.g., 32,767/-32,768)\nare ",Object(i.b)("em",{parentName:"p"},"clamped")," at the maximum or minimum."),Object(i.b)("p",null,"For example, here is an audio signal where the amplitude exceeds the\nrange that can be represented, with the minimum and maximum sample values\nshown as light blue dashed lines:"),Object(i.b)("p",null,Object(i.b)("img",{alt:"Audio signal before clipping",src:n(196).default})),Object(i.b)("p",null,"Clipping will change the waveform to the following:"),Object(i.b)("p",null,Object(i.b)("img",{alt:"Audio signal after clipping",src:n(197).default})),Object(i.b)("p",null,"Humans perceive clipping as distortion of the original signals.\nClipping can be avoided by making sure that audio signals being mixed\nhave relatively small amplitudes, so that the sum of their sample values\nnever exceeds the range of representable sample values."),Object(i.b)("h3",{id:"stereo-sound-wave-files"},"Stereo sound, WAVE files"),Object(i.b)("p",null,"Most sound recordings are ",Object(i.b)("em",{parentName:"p"},"stereo")," meaning that there are separate\nleft and right audio channels.  A common way to represent stereo audio\nis to consider the even-numbered samples (0 being the first sample) as\nbelonging to the left channel, and the odd-numbered samples as belonging\nto the right channel."),Object(i.b)("p",null,"The ",Object(i.b)("a",{parentName:"p",href:"http://soundfile.sapp.org/doc/WaveFormat/"},"WAVE file format")," is a\ncommon file format for digital audio.  Although a variety of encodings\nare possible in WAVE files, they are most commonly used for linear PCM\naudio data.  Wave files represent stereo PCM data using the scheme just\ndescribed (samples 0, 2, 4, etc. belong to the left channel, samples 1,\n3, 5, etc. belong to the right channel.)"),Object(i.b)("p",null,"In this project you will write programs to read and write audio data in\nthe WAVE format.  The good news is that WAVE files are pretty simple:\nthey consist of a ",Object(i.b)("em",{parentName:"p"},"header")," followed by raw sample data.  Digital audio\nprograms can represent sound waveforms internally using arrays with\nsample data.  To read audio data from a WAVE file, a program needs\nto read the header, and then read the raw sample data into an array.\nTo write audio data to a WAVE file, a program needs to write the header,\nand then write the raw sample data from an array."),Object(i.b)("h1",{id:"functional-requirements"},"Functional requirements"),Object(i.b)("p",null,"This section documents the functional requirements of the project."),Object(i.b)("h2",{id:"io-functions"},"I/O functions"),Object(i.b)("p",null,"This section describes the I/O functions that your programs will use to\nread binary data and write binary data.  This program module will also\ndefine an error reporting function called ",Object(i.b)("inlineCode",{parentName:"p"},"fatal_error"),".  These functions\nare declared in ",Object(i.b)("inlineCode",{parentName:"p"},"io.h")," and you will need to define them in ",Object(i.b)("inlineCode",{parentName:"p"},"io.c"),"."),Object(i.b)("h3",{id:"fatal_error-function"},Object(i.b)("inlineCode",{parentName:"h3"},"fatal_error")," function"),Object(i.b)("p",null,"You can start by implementing (in ",Object(i.b)("inlineCode",{parentName:"p"},"io.c"),") the ",Object(i.b)("inlineCode",{parentName:"p"},"fatal_error")," function. It\nis declared in the ",Object(i.b)("inlineCode",{parentName:"p"},"io.h")," header file, as follows:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"void fatal_error(const char *message);\n")),Object(i.b)("p",null,"When this function is called, it should print a line of text to ",Object(i.b)("inlineCode",{parentName:"p"},"stderr")," of the form"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"Error: message text\n")),Object(i.b)("p",null,'where "message text" is the string passed as the ',Object(i.b)("inlineCode",{parentName:"p"},"message")," parameter.\nAfter the message is printed (make sure a newline character is printed\nafter the message), the function should call"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"exit(1);\n")),Object(i.b)("p",null,"to exit the program.  (Exiting with a non-zero exit code is traditionally\nhow Unix and Linux programs indicate that the program execution was\nnot successful.)"),Object(i.b)("p",null,"The purpose of ",Object(i.b)("inlineCode",{parentName:"p"},"fatal_error")," is to immediately exit the program if an\nunrecoverable error, such as unexpected input data, is encountered.\nAlthough this is a somewhat heavy handed way of dealing with errors, it\nis simple.  We will see a more sohisticated and flexible way of reporting\nand handling runtime errors later in the course when we cover ",Object(i.b)("em",{parentName:"p"},"exceptions"),"\nin C++."),Object(i.b)("h3",{id:"binary-io-functions"},"Binary I/O functions"),Object(i.b)("p",null,"WAVE files are ",Object(i.b)("em",{parentName:"p"},"binary")," files, meaning their contents consist of arbitrary byte values."),Object(i.b)("p",null,"Furthermore, the specific type of WAVE file generated and transformed by\nthe programs you will implement in this assignment use ",Object(i.b)("em",{parentName:"p"},"little-endian"),"\nbinary data, where multi-byte values are represented as a sequence of\nbytes such that less significant bytes occur before more significant\nbytes."),Object(i.b)("p",null,"You should start your work by implementing the following binary I/O (input\nand output) functions, which are declared in the ",Object(i.b)("inlineCode",{parentName:"p"},"io.h")," header file:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"void write_byte(FILE *out, char val);\nvoid write_bytes(FILE *out, const char data[], unsigned n);\nvoid write_u16(FILE *out, uint16_t value);\nvoid write_u32(FILE *out, uint32_t value);\nvoid write_s16(FILE *out, int16_t value);\nvoid write_s16_buf(FILE *out, const int16_t buf[], unsigned n);\n\nvoid read_byte(FILE *in, char *val);\nvoid read_bytes(FILE *in, char data[], unsigned n);\nvoid read_u16(FILE *in, uint16_t *val);\nvoid read_u32(FILE *in, uint32_t *val);\nvoid read_s16(FILE *in, int16_t *val);\nvoid read_s16_buf(FILE *in, int16_t buf[], unsigned n);\n")),Object(i.b)("p",null,"All of these functions much be implemented exactly as described below."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"write_byte"),", ",Object(i.b)("inlineCode",{parentName:"p"},"write_u16"),", ",Object(i.b)("inlineCode",{parentName:"p"},"write_u32"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"write_s16")," functions\nwrite a single data value of type ",Object(i.b)("inlineCode",{parentName:"p"},"char"),", ",Object(i.b)("inlineCode",{parentName:"p"},"uint16_t"),", ",Object(i.b)("inlineCode",{parentName:"p"},"uint32_t"),", or\n",Object(i.b)("inlineCode",{parentName:"p"},"int16_t")," respectively."),Object(i.b)("p",null,"Multi-byte data values (",Object(i.b)("inlineCode",{parentName:"p"},"uint16_t"),", ",Object(i.b)("inlineCode",{parentName:"p"},"uint32_t"),", ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t"),") must be written\nin ",Object(i.b)("em",{parentName:"p"},"little-endian")," format, such that less significant bytes are written\nbefore more significant bytes.  Because the ugrad machines use x86-64\nCPUs, which are little-endian, you may read and write multi-byte data\nvalues by simply treating them as a sequence of bytes.  For example,\nto write a ",Object(i.b)("inlineCode",{parentName:"p"},"uint32_t")," stored in a variable ",Object(i.b)("inlineCode",{parentName:"p"},"x")," to a ",Object(i.b)("inlineCode",{parentName:"p"},"FILE *")," file\nhandle called ",Object(i.b)("inlineCode",{parentName:"p"},"out"),", you could use the code"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"fwrite(&x, sizeof(uint32_t), 1, out);\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"write_")," functions should call ",Object(i.b)("inlineCode",{parentName:"p"},"fatal_error")," if an error occurs while writing data."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"write_bytes")," and ",Object(i.b)("inlineCode",{parentName:"p"},"write_s16_buf")," functions write a sequence of\n",Object(i.b)("inlineCode",{parentName:"p"},"char")," or ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t")," values, respectively.\nThe ",Object(i.b)("inlineCode",{parentName:"p"},"write_bytes")," function can be implemented by a single call to\n",Object(i.b)("inlineCode",{parentName:"p"},"fwrite"),".  The ",Object(i.b)("inlineCode",{parentName:"p"},"write_s16_buf")," function can be implemented by calling\n",Object(i.b)("inlineCode",{parentName:"p"},"write_s16")," in a loop, once for each element of the argument array."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"read_byte"),", ",Object(i.b)("inlineCode",{parentName:"p"},"read_u16"),", ",Object(i.b)("inlineCode",{parentName:"p"},"read_u32"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"read_s16")," functions read a\nsingle data value of type ",Object(i.b)("inlineCode",{parentName:"p"},"char"),", ",Object(i.b)("inlineCode",{parentName:"p"},"uint16_t"),", ",Object(i.b)("inlineCode",{parentName:"p"},"uint32_t"),", or ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t"),",\nrespectively, storing the value read in a variable whose address is\npassed as a pointer parameter to the function.\nAs with the functions to write multi-byte values, the functions which\nread multi-byte data values may assume that the little-endian data values\nthey read can be directly stored in memory, because we will be running\non a little endian CPU.  For example, if you need to read a 32 bit\nunsigned value into a ",Object(i.b)("inlineCode",{parentName:"p"},"uint32_t")," variable ",Object(i.b)("inlineCode",{parentName:"p"},"x")," from a ",Object(i.b)("inlineCode",{parentName:"p"},"FILE *")," file\nhandle called ",Object(i.b)("inlineCode",{parentName:"p"},"in"),", you could use the code"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"fread(&x, sizeof(uint32_t), 1, in);\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"read_bytes")," and ",Object(i.b)("inlineCode",{parentName:"p"},"read_s16_buf")," functions read a sequence of ",Object(i.b)("inlineCode",{parentName:"p"},"char"),"\nor ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t")," values, respectively, and store them in the array passed\nas a parameter.  ",Object(i.b)("inlineCode",{parentName:"p"},"read_bytes")," can be implemented by a single call to\n",Object(i.b)("inlineCode",{parentName:"p"},"fread"),".  ",Object(i.b)("inlineCode",{parentName:"p"},"read_s16_buf")," can be implemented by calling ",Object(i.b)("inlineCode",{parentName:"p"},"read_s16")," in a\nloop, once per element."),Object(i.b)("p",null,"If any of the ",Object(i.b)("inlineCode",{parentName:"p"},"read_"),"  functions fail to read the required number of\ndata bytes, they should call the ",Object(i.b)("inlineCode",{parentName:"p"},"fatal_error")," function."),Object(i.b)("h2",{id:"wave-functions"},"Wave functions"),Object(i.b)("p",null,"This section describes functions for working with WAVE files and digital\naudio waveforms.  This module of the program consists of the header file\n",Object(i.b)("inlineCode",{parentName:"p"},"wave.h")," and the source file ",Object(i.b)("inlineCode",{parentName:"p"},"wave.c"),"."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"write_wave_header")," and ",Object(i.b)("inlineCode",{parentName:"p"},"read_wave_header")," functions require the\n",Object(i.b)("a",{parentName:"p",href:"#binary-io-functions"},"binary I/O functions"),", so implement the binary\nI/O functions before working on the wave functions."),Object(i.b)("h3",{id:"waveh"},Object(i.b)("inlineCode",{parentName:"h3"},"wave.h")),Object(i.b)("p",null,"The header file ",Object(i.b)("inlineCode",{parentName:"p"},"wave.h"),", as distributed in the public repo, has the following contents:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"#include <stdint.h>\n\n#define PI                 3.14159265358979323846\n#define SAMPLES_PER_SECOND 44100u\n#define NUM_CHANNELS       2u\n#define BITS_PER_SAMPLE    16u\n\n/* waveforms */\n#define SINE          0\n#define SQUARE        1\n#define SAW           2\n#define NUM_WAVEFORMS 3 /* one greater than maximum legal waveform */\n\n/* timing characteristics for ADSR envelope */\n#define ATTACK_NUM_SAMPLES  882\n#define DECAY_NUM_SAMPLES   882\n#define RELEASE_NUM_SAMPLES 882\n\n// Functions for writing and reading a WAVE header.\nvoid write_wave_header(FILE *out, unsigned num_samples);\nvoid read_wave_header(FILE *in, unsigned *num_samples);\n\n// Compute appropriate gains for a stereo pan at given angle in radians.\n// Left and right channel gains are stored in the channel_gain array.\nvoid compute_pan(float angle, float channel_gain[]);\n\n// Basic full-amplitude wave generation into a mono sample buffer\nvoid generate_sine_wave(int16_t mono_buf[], unsigned num_samples, float freq_hz);\nvoid generate_square_wave(int16_t mono_buf[], unsigned num_samples, float freq_hz);\nvoid generate_saw_wave(int16_t mono_buf[], unsigned num_samples, float freq_hz);\n\n// Scale each sample in a mono sample buffer by specified factor\nvoid apply_gain(int16_t mono_buf[], unsigned num_samples, float gain);\n\n// Apply an ADSR envelope to a mono sample buffer. This should only\n// be done *after* attenuating the contents of the buffer to a reasonable\n// level, since the peak of the attack will actually increase the\n// signal's amplitude.\nvoid apply_adsr_envelope(int16_t mono_buf[], unsigned num_samples);\n\n// Mix a mono sample buffer into a stereo stream.\n// channel should be 0 (left) or 1 (right).\n// stereo_buf should be pointing to a left-channel sample.\nvoid mix_in(int16_t stereo_buf[], unsigned channel, const int16_t mono_buf[], unsigned num_samples);\n")),Object(i.b)("p",null,"The constants ",Object(i.b)("inlineCode",{parentName:"p"},"SAMPLES_PER_SECOND"),", ",Object(i.b)("inlineCode",{parentName:"p"},"NUM_CHANNELS"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"BITS_PER_SAMPLE"),"\ndefine the parameters of stereo CD-quality PCM audio."),Object(i.b)("p",null,"The constant ",Object(i.b)("inlineCode",{parentName:"p"},"PI")," closely approximates the value of \u03c0."),Object(i.b)("p",null,"The constants ",Object(i.b)("inlineCode",{parentName:"p"},"SINE"),", ",Object(i.b)("inlineCode",{parentName:"p"},"SQUARE"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"SAW")," distinguish the three kinds\nof audio waveforms that the ",Object(i.b)("inlineCode",{parentName:"p"},"render_song")," program can generate."),Object(i.b)("p",null,"The function declarations are for functions defined in ",Object(i.b)("inlineCode",{parentName:"p"},"wave.c"),". The\nfunctions are described in more detail below.  Note that you are not required\nto implement any of these functions: how you choose to generate\naudio waveforms is entirely up to you.  However, these functions\ndo provide a good basis for implementing the functionality required\nin this project."),Object(i.b)("h3",{id:"read_wave_header-write_wave_header"},Object(i.b)("inlineCode",{parentName:"h3"},"read_wave_header"),", ",Object(i.b)("inlineCode",{parentName:"h3"},"write_wave_header")),Object(i.b)("p",null,"Two functions called ",Object(i.b)("inlineCode",{parentName:"p"},"read_wave_header")," and ",Object(i.b)("inlineCode",{parentName:"p"},"write_wave_header")," are\nprovided (including implementations in ",Object(i.b)("inlineCode",{parentName:"p"},"wave.c"),") which, respectively, read\nthe header information from a WAVE file, and write header information\nfor a WAVE file.  WAVE files are essentially just header information\nfollowed by a sequence of sample values."),Object(i.b)("p",null,"You can look at the implementation of ",Object(i.b)("inlineCode",{parentName:"p"},"read_wave_header")," and\n",Object(i.b)("inlineCode",{parentName:"p"},"write_wave_header"),' to see how they use your binary I/O functions.\nNote that both functions are hard-coded to support only 16 bits per\nsample, 44.1 KHz, stereo (two channel) WAVE files.  For our purposes,\nthe only "interesting" value in the WAVE header is the number of ',Object(i.b)("em",{parentName:"p"},"stereo"),"\nsamples, which determines the length of the audio.  Note that a stereo\nsample consists of ",Object(i.b)("em",{parentName:"p"},"two")," 16-bit signed integer values, one for each\nchannel (left and right)."),Object(i.b)("p",null,"Here is a very simple example program that calls ",Object(i.b)("inlineCode",{parentName:"p"},"read_wave_header"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},'#include <stdio.h>\n#include <stdlib.h>\n#include "io.h"\n#include "wave.h"\n\nint main(int argc, char **argv) {\n  if (argc != 2) {\n    fprintf(stderr, "Usage: %s <wave file>\\n", argv[0]);\n    exit(1);\n  }\n\n  FILE *in = fopen(argv[1], "rb");\n  if (in == NULL) {\n    fatal_error("Couldn\'t open wave file");\n  }\n\n  unsigned num_samples;\n  read_wave_header(in, &num_samples);\n  printf("Wave file has %u stereo samples\\n", num_samples);\n\n  fclose(in);\n\n  return 0;\n}\n')),Object(i.b)("p",null,"Let's say that we compile and link this program as an executable called ",Object(i.b)("inlineCode",{parentName:"p"},"readwav"),".  If we run the program on the WAVE file called ",Object(i.b)("a",{target:"_blank",href:n(172).default},"a440.wav")," as follows"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"./readwav a440.wav\n")),Object(i.b)("p",null,"The output will be"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"Wave file has 44100 stereo samples\n")),Object(i.b)("h3",{id:"rendering-tones-wave-functions"},"Rendering tones, wave functions"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"generate_sine_wave"),", ",Object(i.b)("inlineCode",{parentName:"p"},"generate_square_wave"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"generate_saw_wave")," functions, as declared in the initial version of ",Object(i.b)("inlineCode",{parentName:"p"},"wave.h"),', are intended to generate full-amplitude sine, square, and sawtooth waveforms with a specified frequency in a specified (mono) sample buffer.  "Full amplitude" means that the sample values should vary over the full range of possible values (-32,768 to 32,767.)'),Object(i.b)("p",null,"A square wave is a waveform where the generated sample values oscillate between maximum and minimum sample values (with respect to the amplitude), i.e."),Object(i.b)("p",null,Object(i.b)("img",{alt:"Square wave",src:n(198).default})),Object(i.b)("p",null,"Square waves are easy to generate using digital electronics, and were used frequently in early home computers and video games.  Here is a 440 Hz square wave:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/a440_sq.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"A sawtooth wave rises steadily from the minimum sample value to the maximum sample value (with respect to amplitude) on each cycle, i.e."),Object(i.b)("p",null,Object(i.b)("img",{alt:"Sawtooth wave",src:n(199).default})),Object(i.b)("p",null,'Sawtooth waves have a more "horn-like" sound than a plain sine wave.  Here is a 440 Hz sawtooth wave:'),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/a440_saw.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"apply_gain")," function modifies the samples in a mono sample buffer\nby scaling them by a specified gain factor. This function is useful for\nreducing the amplitude of a full-amplitude waveform."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"apply_adsr_envelope")," function applies and ADSR (attack, decay, sustain,\nrelease) envelope to the waveform in a mono sample buffer.\nApplying an ADSR envelope to a waveform scales the sample values in the\nwaveform as illustrated by the following diagram:"),Object(i.b)("p",null,Object(i.b)("img",{alt:"ADSR envelope",src:n(200).default})),Object(i.b)("p",null,'The purpose of the envelope is to give rendered notes a more "natural" sound,\nand also to avoid audio artifacts (such as popping) that can occur\nwhen very abrupt volume changes occur.\nDuring the attack phase (labeled "A" in the diagram), the gain increases\nfrom 0 to 1.2.  So, the perceived volume of the waveform will increase from\n0 to 1.2 times the "real" volume during this interval.  During the\ndecay phase (labeled "D" in the diagram), the gain falls from 1.2 to 1.0.\nDuring the sustain phase, the gain is 1.0 (meaning no change to the\nsamples in this interval.)  During the release phase (labeled "R"\nin the diagram), the gain falls from 1.0 to 0.0.  The constants ',Object(i.b)("inlineCode",{parentName:"p"},"ATTACK_NUM_SAMPLES"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"DECAY_NUM_SAMPLES"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"RELEASE_NUM_SAMPLES")," specify the number of samples\nin the attack, release, and decay phases.  All of the samples not in the\nattack, release, or decay phases are considered to be in the sustain phase."),Object(i.b)("p",null,'As a special case, if an ADSR envelope is applied to a waveform that is not\nlong enough to include full attack, decay, and release phases, a simpler "rise/fall"\nenvelope should be applied.  In this type of envelope, the gain should increase\nfrom 0.0 to 1.0 during the first half of the waveform, and fall from 1.0 to 0.0\nin the second half of the waveform.'),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"mix_in")," function takes a rendered mono waveform and mixes it into one channel\nof a stereo sample buffer.  Channel 0 is the left channel, and channel 1 is the right\nchannel.  This function should ensure that sample values stay in the range\n-32,768 to 32,767, clamping them at these minimum and maximum values if necessary."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"compute_pan")," function computes appropriate gain factors for the\nleft and right channels, according to a ",Object(i.b)("em",{parentName:"p"},"pan angle")," specified in radians.\nThis function should use the following gain formulas, where ",Object(i.b)("em",{parentName:"p"},"\u03b8")," is the\npan angle, and ",Object(i.b)("em",{parentName:"p"},"L")," and ",Object(i.b)("em",{parentName:"p"},"R")," are the computed left and right channel gain factors:"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"L")," = \u221a2/2 \xd7 (cos \u03b8 + sin \u03b8)"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"R")," = \u221a2/2 \xd7 (cos \u03b8 - sin \u03b8)"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"render_song")," program will allow instrument sounds to be panned, so\nbeing able to compute appropriate channel gain factors will be important\nfor that program."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Important"),": Note that you do not need to implement any of these\nfunctions exactly as described above.  You will need to\nimplement functions to generate tones, but you are free to implement\nthem in whatever way you think is appropriate.  Having said that,\nthe functions described above, if you implement them, will allow\nyou to complete the required programs in a fairly straightforward way."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Recommendation"),": Don't implement all of the audio generation functions\nat once.  Implement them as needed to support the three programs you\nwill be implementing, ",Object(i.b)("inlineCode",{parentName:"p"},"render_tone"),", ",Object(i.b)("inlineCode",{parentName:"p"},"render_song"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"render_echo"),"."),Object(i.b)("h3",{id:"hints-on-how-to-render-waveforms"},"Hints on how to render waveforms"),Object(i.b)("p",null,"Rendering sine waves is relatively straightforward, since you can use the equation"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"p")," = ",Object(i.b)("em",{parentName:"p"},"a")," \xd7 sin(",Object(i.b)("em",{parentName:"p"},"tf")," \xd7 2\u03c0)"),Object(i.b)("p",null,"more or less directly.  The main thing you'll need to think about is how\nto convert a sample number into a time value ",Object(i.b)("em",{parentName:"p"},"t"),".  (Hint: the number of\nsamples in one second of audio is defined by the ",Object(i.b)("inlineCode",{parentName:"p"},"SAMPLES_PER_SECOND"),"\nconstant.)  Also, because ",Object(i.b)("em",{parentName:"p"},"p")," will range from -1.0 to 1.0, you'll need\nto scale it appropriately to fit the range of the ",Object(i.b)("inlineCode",{parentName:"p"},"int16_t")," data type."),Object(i.b)("p",null,"You can think of square waves as being modified sine waves:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'For any sample where a sine wave would have a non-negative value,\nthe square wave should have a "maximum" value (with respect to amplitude)'),Object(i.b)("li",{parentName:"ul"},'For any sample where a sine wave would have a negative value, the\nsquare wave should have a "minimum" value (with respect to amplitude)')),Object(i.b)("p",null,"The sample values generated for sawtooth waves should increase linearly\nfrom the minimum to maximum throughout each cycle.  One way to implement\nthis is to take the time ",Object(i.b)("em",{parentName:"p"},"t")," of the sample, and divide it by the length\nof one cycle.  For example, let's say the frequency is 440 Hz, which\nwould make the cycle length 1/440 seconds.  If ",Object(i.b)("em",{parentName:"p"},"t")," is 4.9902 seconds,\nthen dividing ",Object(i.b)("em",{parentName:"p"},"t")," by the cycle length gives us approximately 2195.688000.\nSubtracting the ",Object(i.b)("em",{parentName:"p"},"floor")," of this value gives us 0.688.  What this means\nis that for our value of ",Object(i.b)("em",{parentName:"p"},"t")," (4.9902 seconds), the generated sawtooth\nwaveform about 2/3 of the way through the current cycle (0.688 is\nabout 2/3.)  Knowing where ",Object(i.b)("em",{parentName:"p"},"t")," is within the current cycle allows us to\ncompute an appropriate sample value."),Object(i.b)("h3",{id:"mixing-is-additive"},"Mixing is additive!"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"generate_sine_wave"),", ",Object(i.b)("inlineCode",{parentName:"p"},"generate_square_wave"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"generate_saw_wave"),"\nfunctions render a basic waveform in an uninitialized mono sample buffer.\nBecause these functions aren't intended to combine the generated waveform\nwith existing audio data, they can unconditionally assign computed sample values\nto the elements of the sample buffer."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"apply_gain")," and ",Object(i.b)("inlineCode",{parentName:"p"},"apply_adsr_envelope"),"\nfunctions modify the sample values in a mono sample buffer, which will\ntypically be a buffer already initialized by one of the ",Object(i.b)("inlineCode",{parentName:"p"},"generate_"),"\nfunctions."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"mix_in")," function is where a waveform is mixed (combined) with other\naudio signals.  This function should ",Object(i.b)("em",{parentName:"p"},"add"),' the sample values in the\nspecified mono sample buffer with either the left or right sample\nvalues in the specified stereo sample buffer.  This "mixing" process\nallows new waveforms to combine with existing waveform, building layers\nof sound in the resulting stereo audio output.'),Object(i.b)("p",null,"There are a couple of things you should think about in order to make mixing\nwork correctly:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Every element of the stereo sample buffer should be initialized to 0.\nThis means that both channels of the stereo buffer (left and right)\nwill contain only silence."),Object(i.b)("li",{parentName:"ul"},"If the result of adding a new sample value to an existing sample\nvalue is either greater than 32,767 or less than -32,768 (these are\nthe maximum and minimum ",Object(i.b)("inlineCode",{parentName:"li"},"int16_t")," values, respectively), then your code\nshould clamp the result at 32,767 or -32,768.  (See the ",Object(i.b)("a",{parentName:"li",href:"#sound"},"Sound"),"\nsection for details.)  To detect when a computed sample value is outside\nthe legal range, your code will need to do the addition using a data\ntype with a larger range of possible values (e.g., ",Object(i.b)("inlineCode",{parentName:"li"},"int32_t"),".)")),Object(i.b)("h2",{id:"the-render_tone-program"},"The ",Object(i.b)("inlineCode",{parentName:"h2"},"render_tone")," program"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"render_tone")," program renders a continuous tone with a specified\nwaveform, frequency, amplitude, and duration.  This section describes the\nrequirements for the ",Object(i.b)("inlineCode",{parentName:"p"},"render_tone")," program.  This program will be a good\nway for you to validate the implementations of the ",Object(i.b)("a",{parentName:"p",href:"#wave-functions"},"wave functions"),"."),Object(i.b)("h3",{id:"invocation-of-render_tone"},"Invocation of ",Object(i.b)("inlineCode",{parentName:"h3"},"render_tone")),Object(i.b)("p",null,"The program is invoked as"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"./render_tone waveform frequency amplitude numsamples wavfileout\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"waveform")," argument is an integer specifying the waveform shape to\ngenerate: 0 for sine wave, 1 for square wave, 2 for sawtooth wave.\n(See the ",Object(i.b)("a",{parentName:"p",href:"#wave-functions"},"WAVE functions")," section for information about how\nto generate sine, square, and sawtooth waves.)"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"frequency")," argument is a floating-point value\nspecifying the frequency of the tone in Hz (cycles per second.)"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"amplitude")," argument is a floating-point value\nspecifying the relative amplitude of the tone, with 0.0 being complete\nsilence, to 1.0 being maximum volume."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"numsamples")," argument is the number of stereo samples\nto generate.  Because the sampling frequency is fixed at 44.1 KHz,\nthere are 44,100 stereo samples per second.  (Remember that a stereo\nsample consists of two signed 16-bit values, one for each audio channel.)"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"wavfileout")," argument specifies the name of the output\nWAVE file to generate."),Object(i.b)("h3",{id:"render_tone-examples"},Object(i.b)("inlineCode",{parentName:"h3"},"render_tone")," examples"),Object(i.b)("p",null,"Here are some examples of invoking the ",Object(i.b)("inlineCode",{parentName:"p"},"render_tone")," program and what\nthe resulting wave file should sound like."),Object(i.b)("p",null,"Rendering a 130.81 Hz sine wave:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"./render_tone 0 130.81 0.1 44100 c131_sine.wav\n")),Object(i.b)("p",null,"Resulting audio:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/c131_sine.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"Rendering a 130.81 Hz square wave:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"./render_tone 1 130.81 0.1 44100 c131_sq.wav\n")),Object(i.b)("p",null,"Resulting audio:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/c131_sq.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"Rendering a 130.81 Hz sawtooth wave:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"./render_tone 2 130.81 0.1 44100 c131_saw.wav\n")),Object(i.b)("p",null,"Resulting audio:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/c131_saw.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("h3",{id:"render_tone-suggested-approach"},Object(i.b)("inlineCode",{parentName:"h3"},"render_tone")," suggested approach"),Object(i.b)("p",null,"First, the program should allocate an appropriately-sized mono sample buffer,\nand call either ",Object(i.b)("inlineCode",{parentName:"p"},"generate_sine_wave"),", ",Object(i.b)("inlineCode",{parentName:"p"},"generate_square_wave"),", or\n",Object(i.b)("inlineCode",{parentName:"p"},"generate_saw_wave")," to generate an appropriate waveform.  It should also\ncall the ",Object(i.b)("inlineCode",{parentName:"p"},"apply_gain")," function so that the waveform has the specified\namplitude."),Object(i.b)("p",null,"Next, the program should create a stereo sample array of an appropriate length\n(make sure the sample values are initially zero!), and call ",Object(i.b)("inlineCode",{parentName:"p"},"mix_in")," to\nincorporate the waveform into both the left and right channels."),Object(i.b)("p",null,"Finally, the program should open the output file, call the ",Object(i.b)("inlineCode",{parentName:"p"},"write_wave_header"),"\nfunction to write the WAVE header, then write the stereo sample data."),Object(i.b)("p",null,"Make sure that the program frees all allocated memory and closes any file\nthat was opened."),Object(i.b)("h2",{id:"the-render_song-program"},"The ",Object(i.b)("inlineCode",{parentName:"h2"},"render_song")," program"),Object(i.b)("p",null,"This document describes the ",Object(i.b)("inlineCode",{parentName:"p"},"render_song")," program."),Object(i.b)("h3",{id:"invocation-input-data-format"},"Invocation, input data format"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"render_song")," program, whose ",Object(i.b)("inlineCode",{parentName:"p"},"main")," function should be defined in\n",Object(i.b)("inlineCode",{parentName:"p"},"render_song.c"),", is invoked as follows:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"./render_song songinput waveoutput\n")),Object(i.b)("p",null,"The file ",Object(i.b)("inlineCode",{parentName:"p"},"songinput"),' is a text file describing a "song".\nThe first value in a song file is the total number of samples.\nFor example, if this value is'),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"352800\n")),Object(i.b)("p",null,"then the song is 352,800 samples long.  With the fixed 44.1 KHz sample rate,\nthis means that the song is exactly 8 seconds long."),Object(i.b)("p",null,"Next, the song file will have a series of ",Object(i.b)("em",{parentName:"p"},"directives"),".  The following directives\nshould be supported:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"N instrument start end note gain"),": render a note using specified\n",Object(i.b)("inlineCode",{parentName:"li"},"instrument"),", starting at sample number ",Object(i.b)("inlineCode",{parentName:"li"},"start"),", ending just before sample\n",Object(i.b)("inlineCode",{parentName:"li"},"end"),", playing MIDI note number ",Object(i.b)("inlineCode",{parentName:"li"},"note"),", with specified ",Object(i.b)("inlineCode",{parentName:"li"},"gain")," factor"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"W instrument waveform"),": set the waveform of specified instrument, 0 for\nsine, 1 for square, 2 for sawtooth"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"P instrument angle"),": set the stereo pan angle (in radians) of specified instrument"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"E instrument enable"),": enable or disable ADSR envelope on specified instrument\n(0 to disable, 1 to enable)"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"G instrument gain"),": set the gain factor (0.0 to 1.0) of specified instrument")),Object(i.b)("p",null,"All of the numeric values specified in directives are unsigned integers,\nwith the exception of ",Object(i.b)("inlineCode",{parentName:"p"},"gain")," and ",Object(i.b)("inlineCode",{parentName:"p"},"angle"),", which are floating point."),Object(i.b)("p",null,"There are 16 possible instruments that could be used in a song, numbered 0 through 15.  By default each instrument:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Uses the sine waveform"),Object(i.b)("li",{parentName:"ul"},"Has its pan angle set to 0.0 (centered)"),Object(i.b)("li",{parentName:"ul"},"Has the ADSR envelope disabled"),Object(i.b)("li",{parentName:"ul"},"Has its gain set to 0.2")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"W"),", ",Object(i.b)("inlineCode",{parentName:"p"},"P"),", ",Object(i.b)("inlineCode",{parentName:"p"},"E"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"G")," directives modify the characteristics of a specified instrument."),Object(i.b)("p",null,"A ",Object(i.b)("a",{parentName:"p",href:"https://newt.phys.unsw.edu.au/jw/notes.html"},"MIDI note number")," ",Object(i.b)("em",{parentName:"p"},"n")," can be converted to a frequency ",Object(i.b)("em",{parentName:"p"},"f")," using the following formula:"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"f")," = 440 ","\xd7"," 2",Object(i.b)("sup",null,"(",Object(i.b)("i",null,"n"),"-69) / 12")),Object(i.b)("h3",{id:"render_song-example"},Object(i.b)("inlineCode",{parentName:"h3"},"render_song")," example"),Object(i.b)("p",null,"Here is a fairly simple song:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"352800\n\nW 0 1\nE 0 1\nP 0 -0.4\n\nW 1 2\nE 1 1\nP 1 0.4\n\nN 0 0 8820 63 0.8\nN 0 0 8820 66 0.8\nN 1 22050 30870 61 0.8\nN 1 22050 30870 65 0.8\nN 0 44100 52920 63 0.8\nN 0 44100 52920 66 0.8\nN 1 66150 74970 61 0.8\nN 1 66150 74970 65 0.8\nN 0 88200 97020 63 0.8\nN 0 88200 97020 66 0.8\nN 1 110250 119070 61 0.8\nN 1 110250 119070 65 0.8\nN 0 132300 141120 63 0.8\nN 0 132300 141120 66 0.8\nN 1 154350 163170 61 0.8\nN 1 154350 163170 65 0.8\n\nN 0 176400 194040 66 0.8\nN 0 176400 194040 70 0.8\nN 1 220500 238140 66 0.8\nN 1 220500 238140 70 0.8\nN 0 264600 282240 66 0.8\nN 0 264600 282240 70 0.8\n")),Object(i.b)("p",null,"Note that there are two instruments, 0 and 1.  ADSR envelopes are enabled for\nboth instruments.  Instrument 0 plays notes using a square wave, and is panned\nat angle -0.4.  Instrument 1 plays notes using a sawtooth wave, and is panned\nat angle 0.4.  If we save this song in a file called ",Object(i.b)("inlineCode",{parentName:"p"},"example.txt"),", we can\nrender it as a wave file using the command"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"./render_song example.txt example.wav\n")),Object(i.b)("p",null,"The result sounds like this:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/example.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("h3",{id:"important-struct-requirement"},"Important ",Object(i.b)("inlineCode",{parentName:"h3"},"struct")," requirement"),Object(i.b)("p",null,"It is a requirement for this program that you use a ",Object(i.b)("inlineCode",{parentName:"p"},"struct")," data type\n(suggestion: call it ",Object(i.b)("inlineCode",{parentName:"p"},"struct Instrument"),") to represent the information about each instrument. Then, by declaring an array of elements of this type:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"struct Instrument instruments[16];\n")),Object(i.b)("p",null,"you can represent all of the required information about each of the 16\npossible instruments."),Object(i.b)("h3",{id:"render_song-suggested-approach"},Object(i.b)("inlineCode",{parentName:"h3"},"render_song")," suggested approach"),Object(i.b)("p",null,"The program should open the input text file and read the duration from it.\nIt can use the duration to create a stereo sample array of an appropriate\nlength."),Object(i.b)("p",null,"The program's main loop should read directives one at a time and process them."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"N"),"  directives can be carried out by calling ",Object(i.b)("inlineCode",{parentName:"p"},"generate_sine_wave"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"generate_square_wave"),", or ",Object(i.b)("inlineCode",{parentName:"p"},"generate_saw_wave")," to render the note into\na mono sample buffer, calling ",Object(i.b)("inlineCode",{parentName:"p"},"apply_gain")," to scale the samples according\nto the instrument and note gain values, calling ",Object(i.b)("inlineCode",{parentName:"p"},"apply_adsr_envelope"),"\nif appropriate (depending on whether it is enabled for the instrument\nbeing played), calling ",Object(i.b)("inlineCode",{parentName:"p"},"compute_pan")," to compute the appopriate channel\ngain values according to the instruments pan angle, then incorporating\nthe mono sample values into each channel with the correct sample gain.\n(If you use the ",Object(i.b)("inlineCode",{parentName:"p"},"mix_in")," function to do this, you will probably need\nto allocate a separate mono sample buffer to hold the samples scaled\ncorrectly for the output channel.)"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"W"),", ",Object(i.b)("inlineCode",{parentName:"p"},"P"),", ",Object(i.b)("inlineCode",{parentName:"p"},"E"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"G")," directives should modify the appropriate instance\nof the struct type representing instruments. Any modifications to an instrument through one of these input lines will only affect the notes that follow the directive. In other words, it is possible for instrument directives that begin with ",Object(i.b)("inlineCode",{parentName:"p"},"W"),", ",Object(i.b)("inlineCode",{parentName:"p"},"P"),", ",Object(i.b)("inlineCode",{parentName:"p"},"E"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"G")," to be mixed with note directives (lines that begin with ",Object(i.b)("inlineCode",{parentName:"p"},"N"),"). It is also possible for the input file to contain blank lines. Each line should be processed simply according to its first character. If the program encounters the end of file when attempting to read a directive character, it means that the song has ended."),Object(i.b)("p",null,"If the input is malformed (ie, invalid directive character or invalid/missing data for a particular directive), the program should call the ",Object(i.b)("inlineCode",{parentName:"p"},"fatal_error")," function."),Object(i.b)("p",null,"Make sure that all memory is freed and file(s) closed before the program exits."),Object(i.b)("h2",{id:"the-render_echo-program"},"The ",Object(i.b)("inlineCode",{parentName:"h2"},"render_echo")," program"),Object(i.b)("p",null,"This section describes the requirements for the ",Object(i.b)("inlineCode",{parentName:"p"},"render_echo")," program."),Object(i.b)("h3",{id:"invocation"},"Invocation"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"render_echo")," program processes an input WAVE file to generate an echo effect, and is invoked as follows:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"./render_echo wavfilein wavfileout delay amplitude\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"wavfilein")," argument names an input WAVE file."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"wavfileout")," argument names an output WAVE file to write,\nwhich will be a transformed version of ",Object(i.b)("inlineCode",{parentName:"p"},"wavfilein"),"."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"delay")," argument is an integer delay, specified as a number of samples."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"amplitude")," argument is a floating point value in the range 0.0 to 1.0,\nspecifying a relative amplitude of the echo effect to generate."),Object(i.b)("h3",{id:"generating-an-echo"},"Generating an echo"),Object(i.b)("p",null,"Generating an echo is straightforward: the program should add an attenuated copy of\nthe audio signal at an offset as indicated by the ",Object(i.b)("inlineCode",{parentName:"p"},"delay"),"\nargument.  For example, if ",Object(i.b)("inlineCode",{parentName:"p"},"delay")," is 22050, that\nindicates a delay of 0.5 seconds.  The amplitude of the copied signal\nis specified by the ",Object(i.b)("inlineCode",{parentName:"p"},"amplitude")," argument.  For example,\nif ",Object(i.b)("inlineCode",{parentName:"p"},"amplitude")," is 0.4, then the echoed copy of the signal\nshould be 40% of the amplitude of the original."),Object(i.b)("p",null,"Note that the output will need to be ",Object(i.b)("inlineCode",{parentName:"p"},"delay")," number of samples longer than\nthe input, in order to ensure that echoes of samples at the end of the original\nfile are rendered."),Object(i.b)("h3",{id:"examples"},"Examples"),Object(i.b)("p",null,"As an example, let's say that ",Object(i.b)("inlineCode",{parentName:"p"},"example.wav")," is the original version of the\nexample song described in ",Object(i.b)("a",{parentName:"p",href:"#the-render_song-program"},"the render","_","song program"),", and we run the command"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"./render_echo example.wav example_echo.wav 11025 0.4\n")),Object(i.b)("p",null,"Recall that the original sounded like this:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/example.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"The result is this:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/example_echo.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"The following (famous!) audio clip was used to test sound support early\nin the development of the Linux operating system:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/linux.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"Assuming that this file is called ",Object(i.b)("inlineCode",{parentName:"p"},"linux.wav"),", we could add an echo with a 0.5\nsecond delay with the command:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"./render_echo linux.wav linux_echo.wav 22050 0.4\n")),Object(i.b)("p",null,"This yields the following result:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/linux_echo.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("p",null,"We can add an additional echo with a 0.25 second delay with the command:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"./render_echo linux_echo.wav linux_echo2.wav 11025 0.4\n")),Object(i.b)("p",null,"The result of this second command is the following:"),Object(i.b)("audio",{controls:!0},Object(i.b)("source",{src:Object(r.a)("snd/linux_echo2.wav"),type:"audio/wav"})),Object(i.b)("div",null),Object(i.b)("h3",{id:"render_echo-suggested-approach"},Object(i.b)("inlineCode",{parentName:"h3"},"render_echo")," suggested approach"),Object(i.b)("p",null,"Your program will need to open the input file, call ",Object(i.b)("inlineCode",{parentName:"p"},"read_wave_header"),"\nto read the WAVE header and get the number of (stereo) samples, then read\nthe sample data into an array.  Adding the echo effect can be accomplished\nby adding attenuated sample values to the sample value at a later audio\nposition, effectively mixing the echo into the original audio.  Note that\nyou need to be careful about the order in which you process the samples!"),Object(i.b)("p",null,"Once the sample data has been updated, open the output file, call\n",Object(i.b)("inlineCode",{parentName:"p"},"write_wave_header")," to write the WAVE header, then write the updated\nsample values."),Object(i.b)("h2",{id:"testing"},"Testing"),Object(i.b)("p",null,"This section describes how you can test your programs."),Object(i.b)("h3",{id:"getting-files-to-your-local-computer"},"Getting files to your local computer"),Object(i.b)("p",null,"If you develop, compile, and test your programs on one of the ugrad\nmachines, you will need to copy the output WAVE file to your local\nmachine so you can play it using a media player program."),Object(i.b)("p",null,"Let's say that your local repository (cloned from your team's private\nGithub repository) is in the ",Object(i.b)("inlineCode",{parentName:"p"},"midterm_proj")," directory of your ugrad account.\nAlso, let's say that you want to listen to a generated WAVE file called\n",Object(i.b)("inlineCode",{parentName:"p"},"ticktock.wav")," that you generated in ",Object(i.b)("inlineCode",{parentName:"p"},"midterm_proj"),".  You'll need to\nuse either the ",Object(i.b)("inlineCode",{parentName:"p"},"scp")," or ",Object(i.b)("inlineCode",{parentName:"p"},"pscp")," command to copy the file onto your local\nmachine.  For example, on your local machine type:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"scp username@ugradx.cs.jhu.edu:midterm_proj/ticktock.wav .\n")),Object(i.b)("p",null,"(Obviously, replace ",Object(i.b)("inlineCode",{parentName:"p"},"username")," with your username. Remember to add -P 22 to specify port 22 if you normally do that for ",Object(i.b)("inlineCode",{parentName:"p"},"[p]scp"),".)"),Object(i.b)("p",null,"Once you've copied the file onto your local machine, it's very likely\nthat double-clicking it in a file browser will launch a program (VLC,\nWindows media player, etc.) capable of playing it."),Object(i.b)("p",null,"If you're working around other people, you should use headphones or earbuds\nso that you can listen to the generated audio without disturbing them."),Object(i.b)("h3",{id:"example-files"},"Example files"),Object(i.b)("p",null,"The following example files are available.  All of them are available\nfrom the ",Object(i.b)("inlineCode",{parentName:"p"},"midterm")," directory in the public git repository."),Object(i.b)("h3",{id:"song-files"},"Song files"),Object(i.b)("p",null,"Here are some song files you can use as input to your ",Object(i.b)("a",{parentName:"p",href:"#the-render_song-program"},"render","_","song")," program."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Filename"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"a440.txt")),Object(i.b)("td",{parentName:"tr",align:null},"Generate 440 Hz sine wave, output should be ",Object(i.b)("a",{target:"_blank",href:n(172).default},"a440.wav"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"a440_sq.txt")),Object(i.b)("td",{parentName:"tr",align:null},"Generate 440 Hz square wave, output should be ",Object(i.b)("a",{target:"_blank",href:n(201).default},"a440_sq.wav"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"a440_saw.txt")),Object(i.b)("td",{parentName:"tr",align:null},"Generate 440 Hz sawtooth wave, output should be ",Object(i.b)("a",{target:"_blank",href:n(202).default},"a440_saw.wav"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"example.txt")),Object(i.b)("td",{parentName:"tr",align:null},"Example song described above, output should be ",Object(i.b)("a",{target:"_blank",href:n(203).default},"example.wav"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"tocc_dm.txt")),Object(i.b)("td",{parentName:"tr",align:null},"Toccata and Fugue in D Minor (BWV 538), output should be ",Object(i.b)("a",{target:"_blank",href:n(204).default},"tocc_dm.mp3"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"bwv645.txt")),Object(i.b)("td",{parentName:"tr",align:null},"Wachet auf, ruft uns die Stimme (BWV 645), output should be ",Object(i.b)("a",{target:"_blank",href:n(205).default},"bwv645.mp3"))))),Object(i.b)("p",null,'Note that in the case of the larger songs, the "expected" output is in MP3 format\nto save space.  Because MP3 involves lossy compression, the audio frequencies\nand amplitudes aren\'t exactly the same as in the original uncompressed\nWAVE file, but to a human listener they will sound very close.'),Object(i.b)("p",null,"You should make your own song files, too!"),Object(i.b)("h3",{id:"sound-files"},"Sound files"),Object(i.b)("p",null,"The ",Object(i.b)("a",{parentName:"p",href:"#the-render_echo-program"},"render","_","echo")," program requires a WAVE file\nas input.  You can use any of the files linked above (except for the MP3 files),\nor one of the following files:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Filename"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"linux.wav")),Object(i.b)("td",{parentName:"tr",align:null},'Linus Torvalds explaining how to pronounce "Linux"')),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"linux_echo.wav")),Object(i.b)("td",{parentName:"tr",align:null},"Output of ",Object(i.b)("inlineCode",{parentName:"td"},"./render_echo linux.wav linux_echo.wav 22050 0.4"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"linux_echo2.wav")),Object(i.b)("td",{parentName:"tr",align:null},"Output of ",Object(i.b)("inlineCode",{parentName:"td"},"./render_echo linux_echo.wav linux_echo2.wav 11025 0.4"))))),Object(i.b)("h2",{id:"tips"},"Tips"),Object(i.b)("p",null,"This section has some useful tips and tricks to consider as you work on the project."),Object(i.b)("h3",{id:"passing-part-of-an-array-to-a-function"},"Passing part of an array to a function"),Object(i.b)("p",null,"Because arrays are passed as pointers (where the pointer points to\nthe first element of the array), you can pass ",Object(i.b)("em",{parentName:"p"},"part")," of an array to a\nfunction by passing a pointer to one of the array's elements."),Object(i.b)("p",null,"For example, let's say that you want to call the ",Object(i.b)("inlineCode",{parentName:"p"},"mix_in")," function\nto mix the samples in a mono sample buffer into channel 0 (the\nleft channel) of a stereo sample buffer, starting at a specified sample.\nThe call might look something like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},"mix_in(stereo_buf + (start * 2), 0, mono_buf, num_samples);\n")),Object(i.b)("p",null,"The starting sample number is multiplied by 2 because the stereo sample\nbuffer contains pairs of samples."),Object(i.b)("h3",{id:"math-functions"},"Math functions"),Object(i.b)("p",null,"Standard math functions such as ",Object(i.b)("inlineCode",{parentName:"p"},"sin"),", ",Object(i.b)("inlineCode",{parentName:"p"},"pow"),", ",Object(i.b)("inlineCode",{parentName:"p"},"floor"),", and potentially\nothers will be useful for rendering waveforms."),Object(i.b)("h3",{id:"converting-command-line-arguments-to-numeric-values"},"Converting command line arguments to numeric values"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"render_tone")," and ",Object(i.b)("inlineCode",{parentName:"p"},"render_echo")," programs both take command line\narguments which need to be converted to a numeric value.  The ",Object(i.b)("inlineCode",{parentName:"p"},"sscanf"),"\nfunction (available if you include the ",Object(i.b)("inlineCode",{parentName:"p"},"<stdio.h>")," header) is\nvery useful for this purpose, since it reads text data from a character\nstring."),Object(i.b)("p",null,"For example: the ",Object(i.b)("inlineCode",{parentName:"p"},"render_tone")," program's second command line argument is a\nfloating point value specifying the frequency of the generated tone.  Your\n",Object(i.b)("inlineCode",{parentName:"p"},"main")," function could use code like the following to get the frequency:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},'float freq;\nif (sscanf(argv[2], "%f", &freq) != 1) {\n  fatal_error("Invalid frequency");\n}\n')),Object(i.b)("p",null,"Note that you will need to be careful about using the correct placeholder,\ndepending on the type of the variable you want to use to store the data.\nFor example, to read a floating-point value into a ",Object(i.b)("inlineCode",{parentName:"p"},"double")," variable,\nyou need to use the ",Object(i.b)("inlineCode",{parentName:"p"},"%lf")," placeholder."),Object(i.b)("h3",{id:"use-binary-mode-for-input-and-output"},"Use binary mode for input and output"),Object(i.b)("p",null,'For reading and writing binary files such as WAVE files, make sure you\nuse "b" in the file mode.  For example:'),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-c"},'FILE *in = fopen("input.wav", "rb");\nFILE *out = fopen("output.wav", "wb");\n')),Object(i.b)("p",null,'The "b" flag is optional on Unix systems (including Linux and MacOS),\nbut is necessary on some systems (such as Windows).'),Object(i.b)("h2",{id:"packaging-and-submission-requirements"},"Packaging and submission requirements"),Object(i.b)("p",null,"This section describes the packaging and submission requirements."),Object(i.b)("p",null,"Your project must include a ",Object(i.b)("inlineCode",{parentName:"p"},"Makefile")," which has targets which build the\n",Object(i.b)("inlineCode",{parentName:"p"},"render_tone"),", ",Object(i.b)("inlineCode",{parentName:"p"},"render_song"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"render_echo")," programs.  These targets\nmust specify dependencies on the appropriate object (",Object(i.b)("inlineCode",{parentName:"p"},".o"),") files.\nThe targets for object files must have appropriate dependencies on a\nsource (",Object(i.b)("inlineCode",{parentName:"p"},".c"),") file and any header (",Object(i.b)("inlineCode",{parentName:"p"},".h"),") files used directly or indirectly\nin compiling the object file."),Object(i.b)("p",null,"Your ",Object(i.b)("inlineCode",{parentName:"p"},"Makefile")," must also have a ",Object(i.b)("inlineCode",{parentName:"p"},"clean")," target which deletes all\nobject (",Object(i.b)("inlineCode",{parentName:"p"},".o"),") files and executables (",Object(i.b)("inlineCode",{parentName:"p"},"render_tone"),", ",Object(i.b)("inlineCode",{parentName:"p"},"render_song"),", and\n",Object(i.b)("inlineCode",{parentName:"p"},"render_echo"),".)"),Object(i.b)("p",null,"Keep in mind that your programs will need to link with the math library,\nso add ",Object(i.b)("inlineCode",{parentName:"p"},"-lm")," to your linking commands."),Object(i.b)("p",null,"Your project must include a ",Object(i.b)("inlineCode",{parentName:"p"},"README")," file that contains your names and JHED IDs\nand briefly explains each team member's contributions to the project."),Object(i.b)("p",null,"To submit, first generate a Git log:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"git log > gitlog.txt\n")),Object(i.b)("p",null,"Then create a zipfile with with your ",Object(i.b)("inlineCode",{parentName:"p"},".c")," files, ",Object(i.b)("inlineCode",{parentName:"p"},".h")," files, ",Object(i.b)("inlineCode",{parentName:"p"},"Makefile"),", ",Object(i.b)("inlineCode",{parentName:"p"},"README"),", and Git log:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"zip midterm_proj.zip Makefile *.c *.h README gitlog.txt\n")),Object(i.b)("p",null,"Upload ",Object(i.b)("inlineCode",{parentName:"p"},"midterm_proj.zip")," to Gradescope as ",Object(i.b)("strong",{parentName:"p"},"Midterm project"),"."),Object(i.b)("p",null,"Make sure that you do ",Object(i.b)("strong",{parentName:"p"},"not")," submit any WAVE (",Object(i.b)("inlineCode",{parentName:"p"},".wav"),") files."))}p.isMDXComponent=!0}}]);